<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:CarListApp.Maui.Features.Auth.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:constants="clr-namespace:CarListApp.Maui.Core.Constants"
             x:Class="CarListApp.Maui.Features.Auth.Views.ProfilePage"
             x:DataType="viewmodel:ProfileViewModel">

    <Grid Style="{StaticResource PageContentGrid}"
          RowDefinitions="Auto,*,Auto">

        <!-- Loading Overlay -->
        <Grid IsVisible="{Binding IsBusy}"
              InputTransparent="False"
              BackgroundColor="{StaticResource LoadingOverlayColor}"
              Grid.RowSpan="3">
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                             HorizontalOptions="Center"
                             VerticalOptions="Center"
                             Color="{StaticResource Primary}"/>
        </Grid>

        <!-- Header -->
        <Label Text="Profile"
               Style="{StaticResource PageTitleLabel}"
               TextColor="{StaticResource PrimaryTextColor}"/>

        <!-- Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="{StaticResource SpacingNormal}">
                
                <!-- User Info Card -->
                <Frame Style="{StaticResource CardFrame}"
                       BackgroundColor="{StaticResource CardBackgroundColor}">
                    <Grid RowDefinitions="Auto,Auto,Auto" 
                          RowSpacing="{StaticResource SpacingNormal}">
                        
                        <!-- Profile Icon -->
                        <Frame HeightRequest="80" 
                               WidthRequest="80"
                               CornerRadius="40"
                               Padding="0"
                               HorizontalOptions="Center"
                               BackgroundColor="{StaticResource Primary}">
                            <Label Text="{x:Static constants:FontAwesomeIcons.User}"
                                   Style="{StaticResource IconLabel}"
                                   TextColor="{StaticResource White}"
                                   FontSize="40"/>
                        </Frame>

                        <!-- User Details -->
                        <VerticalStackLayout Grid.Row="1" 
                                           Spacing="{StaticResource SpacingSmall}">
                            <Label Text="{Binding UserInfo.Username}"
                                   Style="{StaticResource SectionTitleLabel}"
                                   TextColor="{StaticResource PrimaryTextColor}"
                                   HorizontalOptions="Center"/>
                            <Label Text="{Binding UserInfo.Email}"
                                   TextColor="{StaticResource SecondaryTextColor}"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Grid>
                </Frame>

                <!-- Theme Settings Card -->
                <Frame Style="{StaticResource CardFrame}"
                       BackgroundColor="{StaticResource CardBackgroundColor}">
                    <VerticalStackLayout Spacing="{StaticResource SpacingNormal}">
                        <Label Text="Theme Settings"
                               Style="{StaticResource SectionTitleLabel}"
                               TextColor="{StaticResource PrimaryTextColor}"/>

                        <!-- Dark Mode Toggle -->
                        <Grid ColumnDefinitions="*,Auto" 
                              RowDefinitions="Auto"
                              RowSpacing="{StaticResource SpacingTiny}">
                            <Label Text="{Binding IsDarkMode, StringFormat='{0} Mode', Converter={StaticResource BoolToStringConverter}, ConverterParameter='Light|Dark'}"
                                   TextColor="{StaticResource PrimaryTextColor}"
                                   VerticalOptions="Center"/>
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsDarkMode}"
                                    Style="{StaticResource FormSwitch}"
                                    Toggled="OnThemeToggled"/>
                        </Grid>

                        <!-- Color Picker -->
                        <VerticalStackLayout Spacing="{StaticResource SpacingSmall}">
                            <Label Text="Primary Color"
                                   TextColor="{StaticResource PrimaryTextColor}"/>
                            <Grid ColumnDefinitions="*,Auto" 
                                  ColumnSpacing="{StaticResource SpacingSmall}">
                                <Entry Text="{Binding PrimaryColor}"
                                       Style="{StaticResource FormEntry}"
                                       TextColor="{StaticResource PrimaryTextColor}"
                                       BackgroundColor="{StaticResource InputBackgroundColor}"
                                       Placeholder="Enter hex color (e.g. #6B4EFF)"
                                       PlaceholderColor="{StaticResource TertiaryTextColor}"/>
                                <Frame Grid.Column="1"
                                       HeightRequest="44"
                                       WidthRequest="44"
                                       Padding="0"
                                       BackgroundColor="{Binding PrimaryColor}"
                                       BorderColor="{StaticResource BorderColor}"
                                       CornerRadius="4"/>
                            </Grid>
                            <Button Text="Apply Color"
                                    Command="{Binding UpdatePrimaryColorCommand}"
                                    Style="{StaticResource SecondaryButton}"/>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Footer -->
        <Button Grid.Row="2"
                Text="Logout"
                Command="{Binding LogoutCommand}"
                Style="{StaticResource PrimaryButton}"/>
    </Grid>
</ContentPage> 